<?php

/**
 * Email
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 7691 2011-02-04 15:43:29Z jwage $
 */
class Emails extends BaseEmails
{


    /**
     *  return template list
     *  @author asharma
     */

    public static function getAllEmailsContent($params)
    {

        $emailsList = Doctrine_Query::create()
            ->select('e.id,e.type,e.send_date, e.send_counter')
            ->from("Emails e")
            ->where("e.deleted='0'");
        $result	=	DataTable_Helper::generateDataTableResponse($emailsList,
                $params,
                array("__identifier" => 'e.id','e.id','e.type','e.send_date','e.send_counter'),
                array(),
                array());
        return $result;

    }


    /**
     *  return template data
     *  @author asharma
     */

    public static function getTemplateContent($id)
    {

     $templatedata = Doctrine_Query::create()
            ->select('e.header, e.footer, e.body')
            ->from("Emails e")
            ->where("e.deleted='0'")
            ->andWhere("e.id=".$id)
            ->fetchArray();

        return $templatedata;

    }

    /**
     *  update Header
     *  @author asharma
     */

    public static function updateHeaderContent($data, $id)
    {

     //update header of emails
            $email = Doctrine_Query::create()->update('Emails')
            ->set('header', "'$data'")->where('id=' . $id);
            $email->execute();

    }

    /**
     *  update Footer
     *  @author asharma
     */

    public static function updateFooterContent($data, $id)
    {

     //update header of emails
            $email = Doctrine_Query::create()->update('Emails')
            ->set('footer', "'$data'")->where('id=' . $id);
            $email->execute();

    }

    /**
     *  update Body
     *  @author asharma
     */

    public static function updateBodyContent($data, $id)
    {

     //update header of emails
            $email = Doctrine_Query::create()->update('Emails')
            ->set('body', "'$data'")->where('id=' . $id);
            $email->execute();

    }


    /**
     *  get template id
     *  @author asharma
     */

    public static function getTemplateId($type)
    {

     $id = Doctrine_Query::create()
            ->select('e.id')
            ->from("Emails e")
            ->where("e.deleted='0'")
            ->andWhere("e.type='". $type . "'")
            ->fetchArray();

        return $id;

    }

    /**
     *  get counter value
     *  @author asharma
     */

    public static function getSendCounter($id)
    {

     $count = Doctrine_Query::create()
            ->select('e.send_counter')
            ->from("Emails e")
            ->where("e.deleted='0'")
            ->andWhere("e.id=".$id)
            ->fetchArray();

        return $count;

    }

    /**
     *  update Send Date and Counter
     *  @author asharma
     */

    public static function updateDateCounter($count, $id)
    {
        $date = new Zend_Date();
        $count = Doctrine_Query::create()->update('Emails')
            ->set('send_counter', "'$count'")
            ->set('send_date', "'$date'")
            ->where('id=' . $id);
            $count->execute();

    }


}
